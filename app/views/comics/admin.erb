<span class='W100 bl left'>
  
  <span class="W20 minH3em left Blttan white center">
    <span class="W40 pad2 left Blttan">
      <a id="addComic" href="#">Add Blank Comic</a>
    </span>
    <span class="W40 pad2 left Blttan white" id="comicCount">
      <%= @cnt %>
    </span>
  </span>

  <span class="W20 minH3em left Blttan white">
    <%= form_for @arc, class: 'left bl W100 ', multipart: true do |f| %>
      <%= f.label :title, "Arc Title" %>
      <%= f.text_field :title %>
      <%= f.submit 'Create Arc', class: 'in' %>
    <% end %>
  </span> 

  <span class="W10 minH3em left Blttan white center">
    Select Arc
  </span>

  <span class="W10 minH3em left Blttan white">

    <select id="selectArc" class="W100 bl left">
        
      <% @arcs.each do |a| %>

        <option value="<%= a.id %>">
          <%= a.title %>
        </option>

      <% end %>
    </select>
  </span>

  <span class="W10 minH3em left Blttan white"></span>

  <span class="W10 minH3em left Blttan white">
    <button id="letsDoThis" class="W100 center">Let's Do This!</button>
  </span>

  <span class="W10 minH3em left Blttan white" id="errorBox"></span>

</span>

<span class='W100 bl left' id="the-comics">

  <%= render 'comics/new_comic' %>

</span>

<span class="W100 bl left minH2em"></span>
  
<script type="text/javascript">

  function fillFromSketch(info){
    // go cnt times, new comic, fill each


  }
  
  function moveIt(count, up) {
    var disComic = $('.comicCount' + count);

    if(up){
      
      var prevComic = $('.comicCount' + (count - 1));

      if(prevComic.length){

        disComic.insertBefore( prevComic ).removeClass('comicCount' + count).find('span.buttonCon').data('count', (count - 1));
        prevComic.removeClass('comicCount' + (count - 1)).addClass('comicCount' + count).find('span.buttonCon').data('count', 1);
        disComic.addClass('comicCount' + (count - 1));  
      }
      
    } else {

      var nextComic = $('.comicCount' + (count + 1));

      if(nextComic.length){

        disComic.insertAfter( nextComic ).removeClass('comicCount' + count).find('span.buttonCon').data('count', (count + 1));
        nextComic.removeClass('comicCount' + (count + 1)).addClass('comicCount' + count).find('span.buttonCon').data('count', count);
        disComic.addClass('comicCount' + (count + 1));
      }
    }

    resetButtons();
  }

  function resetButtons(){

    $('.upButton .downButton').off('click');

    // hide up button for top
    $('.buttonCon[data-count="1"]').find('a.upButton').hide();
    $('.downButton').hide();

    var allButtonCons = $('span.buttonCon');
    var counts = [];
    allButtonCons.each(function() {
      counts.push($(this).data('count'));
    });

    var maxy = Math.max(...counts);
    allButtonCons.not('span.buttonCon[data-count="' + maxy + '"]').find('a.downButton').show();

    $('.upButton:visible').each(function() {
      var counto = $(this).parent().data('count');

      $(this).click(function() {
        console.log(counto)
        moveIt(counto, true);
      });
    });

    $('.downButton:visible').each(function() {
      $(this).click(function() {
        
        var counto = $(this).parent().data('count');
        moveIt(counto, false);
      });
    });
  }

  $(document).ready(function () {
  
    var AUTH_TOKEN=$('meta[name="csrf-token"]').attr('content');
    
    $('#letsDoThis').click(function() {

      var cow = 0;

      // read all forms
      var arcChoice = $('#selectArc').val();
      var comicDetails = [];

      $('.newComic').each(function() {
        cow += 1;

        // I sure hope an image was uploaded!
        var disId = $(this).attr('id');

        // get title, desc, 
        var thisTit = $(this).find('input.comicTitle').val();
        var thisDesc = $(this).find('input.comicDesc').val();

        comicDetails.push({comic: {id: disId, title: thisTit, desc: thisDesc, pos: cow}});
      });

      var idsPresent = true;

      for(var i=0; i<comicDetails.length; i++){
        if( !(idsPresent && ( comicDetails[i].comic.id.length > 0 )) ){
          idsPresent = false;
        }
      }

      if(idsPresent){

        $.ajax({type: 'POST',
                data: {arc_id: arcChoice, comicDetails},
                url: '/arcs/save_arc',
                beforeSend: function(xhr) { 
                  xhr.setRequestHeader('X-CSRF-Token', AUTH_TOKEN) 
                },
        });

        $('#errorBox').empty();
      } else {
        $('#errorBox').html('Hmm... Images are missing. You better find em!')
      }
    });

    $('#addComic').click(function () {
      $.get('/comics/count', function(data, res){
        $('#comicCount').html(data.count);
        $.get('/comics/new_comic', function() {});
      });
    });
  });
</script>  